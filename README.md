# Генератор соглашений ЭДО

Автоматизированная система для генерации соглашений об электронном документообороте для компаний КАДИС и ЮрРегионИнформ.

## Возможности

- Автоматическое получение данных руководителей через API Контур.Фокус
- Преобразование должностей и ФИО в родительный падеж через OpenAI API
- Заполнение шаблонов документов Word (.docx)
- Ведение баз данных контрагентов
- Подробное логирование всех операций
- Современный графический интерфейс

## Установка

### 1. Установите Python 3.8 или выше

Скачайте с официального сайта: https://www.python.org/downloads/

### 2. Установите зависимости

```bash
pip install -r requirements.txt
```

### 3. Подготовьте структуру проекта

Убедитесь, что у вас есть следующая структура:

```
agreement_generator/
├── main.py                     # Главный файл приложения
├── requirements.txt            # Зависимости
├── config.json                 # Конфигурация (создается автоматически)
├── modules/                    # Модули приложения
│   ├── contur_focus.py        # Скрипт для работы с Контур.Фокус API
│   ├── database_manager.py    # Менеджер баз данных
│   ├── openai_processor.py    # Обработчик OpenAI API
│   ├── document_processor.py  # Обработчик документов Word
│   ├── agreement_processor.py # Главный процессор
│   └── logger_manager.py      # Менеджер логирования
├── database/                   # Базы данных (создается автоматически)
├── data/                       # Шаблоны документов
│   ├── KADIS_IP_shablon.docx
│   ├── KADIS_OOO_shablon.docx
│   ├── URI_IP_shablon.docx
│   └── URI_OOO_shablon.docx
├── logs/                       # Логи (создается автоматически)
└── Соглашения/                 # Готовые соглашения (создается автоматически)
    ├── КАДИС/
    └── ЮрРегионИнформ/
```

### 4. Добавьте шаблоны документов

Поместите файлы шаблонов в папку `data/`:
- `KADIS_IP_shablon.docx` - шаблон для ИП (КАДИС)
- `KADIS_OOO_shablon.docx` - шаблон для ЮЛ (КАДИС)
- `URI_IP_shablon.docx` - шаблон для ИП (ЮрРегионИнформ)
- `URI_OOO_shablon.docx` - шаблон для ЮЛ (ЮрРегионИнформ)

## Запуск

```bash
python main.py
```

## Использование

### 1. Ввод API ключа

1. Получите API ключ OpenAI: https://platform.openai.com/api-keys
2. Введите ключ в поле "OpenAI API Key"
3. Нажмите "Сохранить API ключ"

### 2. Создание базы данных

1. Выберите компанию (КАДИС или ЮрРегионИнформ)
2. Нажмите "Создать/Обновить базу данных из CSV"
3. Выберите CSV файл с существующими контрагентами (структура как на скриншоте 1)

**Формат CSV для создания БД:**
- Юр.лицо / Название организации
- Поставщик
- Количество
- ИНН
- КПП

### 3. Обработка контрагентов

1. Выберите компанию
2. Нажмите "Загрузить CSV и начать обработку"
3. Выберите CSV файл с контрагентами для обработки (структура как на скриншоте 2)

**Формат CSV для обработки:**
- Название организации
- ИНН
- КПП (для ЮЛ)
- Другие поля...

Программа автоматически:
- Проверит контрагентов по базе данных
- Получит данные руководителей через Контур.Фокус
- Преобразует должности в родительный падеж через OpenAI
- Заполнит шаблоны документов
- Сохранит готовые соглашения
- Обновит базу данных

### 4. Обработка ошибок

При возникновении ошибок программа предложит:
- **Прервать** - остановить обработку
- **Повторить** - повторить операцию
- **Пропустить** - пропустить текущий контрагент

### 5. Результаты

Готовые соглашения сохраняются в:
```
Соглашения/
└── [КАДИС или ЮрРегионИнформ]/
    └── [дата в формате дд.мм.гг]/
        ├── Соглашение_ЭДО_[Название организации].docx
        └── ...
```

Логи сохраняются в:
```
logs/
└── session_[дата]_[время].log
```

## Шаблоны документов

### Плейсхолдеры для шаблонов ИП:
- `{{IP}}` - полное название ИП (например "ИП Иванов Иван Иванович")
- `{{IP_INN}}` - ИНН
- `{{dd}}` - день
- `{{mm}}` - месяц словами
- `{{yy}}` - год
- `{{fio}}` - ФИО в формате И.О. Фамилия (например "И.И. Иванов")

### Плейсхолдеры для шаблонов ЮЛ:
- `{{JL}}` - полное название организации
- `{{post_fixed}}` - должность в родительном падеже (с маленькой буквы)
- `{{fio_fixed}}` - ФИО в родительном падеже
- `{{dd}}` - день
- `{{mm}}` - месяц словами
- `{{yy}}` - год
- `{{JL_INN}}` - ИНН
- `{{JL_KPP}}` - КПП
- `{{post}}` - должность в именительном падеже (с большой буквы)
- `{{fio}}` - ФИО в формате И.О. Фамилия

## API и прокси

### Контур.Фокус API
- API ключ встроен в `contur_focus.py`
- Базовый URL: `https://focus-api.kontur.ru/api3`

### OpenAI API
- Модель: gpt-5-nano
- Работает через прокси (настройки в `openai_processor.py`)
- Прокси: 

## Устранение неполадок

### Ошибка: "Шаблон не найден"
Убедитесь, что все шаблоны находятся в папке `data/`

### Ошибка OpenAI API
- Проверьте правильность API ключа
- Убедитесь, что прокси доступен
- Проверьте баланс аккаунта OpenAI

### Ошибка при работе с Контур.Фокус
- Проверьте API ключ в `contur_focus.py`
- Проверьте доступность API Контур.Фокус

### Проблемы с CSV
- Убедитесь, что файл в кодировке UTF-8
- Проверьте наличие всех необходимых колонок
- ИНН может быть в научной нотации - программа исправит автоматически

## Системные требования

- Python 3.8+
- Windows / Linux / macOS
- Интернет-соединение (для API)
- ~100 МБ свободного места

## Лицензия

Proprietary - для внутреннего использования компании

## Поддержка

При возникновении проблем проверьте:
1. Логи в папке `logs/`
2. Журнал работы в интерфейсе программы
3. Консоль при запуске из командной строки
